define("mod_mumie/mod_form",["jquery","core/templates","core/modal_factory","auth_mumie/mumie_server_config","core/ajax"],(function(){var lmsSelectorUrl,systemLanguage,serverStructure,serverDropDown,languageElem,taskSelectionInput,nameElem,taskDisplayElement,isGradedElem,propertySelectionInputs,selectedTaskProperties,selectedTaskProp,taskSelectionInputs,selectedTasks,selectedTaskIds,sectionInputs,worksheetElement,addServerButton=document.getElementById("id_add_server_button"),missingConfig=document.getElementsByName("mumie_missing_config")[0],serverController=(serverDropDown=document.getElementById("id_server"),{init:function(structure){serverStructure=structure},getSelectedServer:function(){var selectedServerName=serverDropDown.options[serverDropDown.selectedIndex].text;return serverStructure.find((function(server){return server.name===selectedServerName}))},disable:function(){serverDropDown.disabled=!0,function(elem){for(;elem.firstChild;)elem.removeChild(elem.firstChild)}(serverDropDown)}}),problemSelectorController=function(){var problemSelectorWindow,problemSelectorButton=document.getElementById("id_prb_selector_btn"),mumieOrg=document.getElementsByName("mumie_org")[0].value;function sendResponse(response){problemSelectorWindow&&problemSelectorWindow.postMessage(JSON.stringify(response),lmsSelectorUrl)}function sendSuccess(){var message=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";sendResponse({success:!0,message:message})}function addMessageListener(){window.addEventListener("message",(function(event){var _importObj$worksheet;if(event.origin===lmsSelectorUrl){var importObj=JSON.parse(event.data),isGraded=!1!==importObj.isGraded,worksheet=null!==(_importObj$worksheet=importObj.worksheet)&&void 0!==_importObj$worksheet?_importObj$worksheet:null;try{courseController.setCourse(importObj.path_to_coursefile),langController.setLanguage(importObj.language),taskController.setSelection(importObj.link,importObj.language,importObj.name),taskController.setIsGraded(isGraded),worksheetController.setWorksheet(worksheet),sendSuccess(),window.focus(),require(["core/str","core/notification"],(function(str,notification){str.get_strings([{key:"mumie_form_updated_selection",component:"mod_mumie"}]).done((function(s){notification.addNotification({message:s[0],type:"info"})})).fail(notification.exception)}))}catch(error){!function(){sendResponse({success:!1,message:arguments.length>0&&void 0!==arguments[0]?arguments[0]:""})}(error.message)}}}),!1)}return{init:function(){var gradingType=taskController.getGradingType();problemSelectorButton.onclick=function(){problemSelectorWindow=window.open(lmsSelectorUrl+"/lms-problem-selector?org="+mumieOrg+"&serverUrl="+encodeURIComponent(serverController.getSelectedServer().urlprefix)+"&problemLang="+langController.getSelectedLanguage()+"&origin="+encodeURIComponent(window.location.origin)+"&uiLang="+systemLanguage+"&gradingType="+gradingType+"&multiCourse=true&worksheet=true","_blank")},window.onclose=function(){sendSuccess()},window.addEventListener("beforeunload",(function(){sendSuccess()}),!1),addMessageListener()},disable:function(){problemSelectorButton.disabled=!0}}}(),courseController=function(){var courseNameElem=document.getElementById("id_mumie_course"),coursefileElem=document.getElementsByName("mumie_coursefile")[0];function _updateCourseName(){var _selectedCourse$name$,selectedCourse=courseController.getSelectedCourse(),selectedLanguage=langController.getSelectedLanguage();selectedCourse&&selectedLanguage&&(courseNameElem.value=null===(_selectedCourse$name$=selectedCourse.name.find((function(translation){return translation.language===selectedLanguage})))||void 0===_selectedCourse$name$?void 0:_selectedCourse$name$.value)}return{init:function(){_updateCourseName()},getSelectedCourse:function(){return serverController.getSelectedServer().courses.find((function(course){return course.coursefile===coursefileElem.value}))},updateCourseName:function(){_updateCourseName()},setCourse:function(courseFile){var coursefile;coursefile=courseFile,coursefileElem.value=coursefile,_updateCourseName()}}}(),langController=(languageElem=document.getElementById("id_language"),{getSelectedLanguage:function(){return languageElem.value},setLanguage:function(lang){if(!function(lang){return courseController.getSelectedCourse().languages.includes(lang)}(lang))throw new Error("Selected language not available");languageElem.value=lang,courseController.updateCourseName()}}),taskController=(taskSelectionInput=document.getElementsByName("taskurl")[0],nameElem=document.getElementById("id_name"),taskDisplayElement=document.getElementById("id_task_display_element"),isGradedElem=document.getElementById("id_mumie_isgraded"),{init:function(){},setSelection:function(link,language,name){taskSelectionInput.value=link+"?lang="+language,function(name){taskDisplayElement.value=name,nameElem.value=name}(name)},setIsGraded:function(isGraded){var disabled;null===isGraded&&(isGradedElem.value=null),isGradedElem.value=isGraded?"1":"0",disabled="0"===isGradedElem.value,document.getElementById("id_points").disabled=disabled,document.getElementById("id_gradepass").disabled=disabled,document.getElementById("id_duedate_enabled").disabled=disabled,document.getElementById("id_gradecat").disabled=disabled},getGradingType:function(){var isGraded=isGradedElem.value;return"1"===isGraded?"graded":"0"===isGraded?"ungraded":"all"}}),multiTaskEditController=(propertySelectionInputs=document.getElementsByName("mumie_multi_edit_property"),selectedTaskProperties=document.getElementsByName("mumie_selected_task_properties")[0],selectedTaskProp=[],taskSelectionInputs=document.getElementsByName("mumie_multi_edit_task"),selectedTasks=document.getElementsByName("mumie_selected_tasks")[0],selectedTaskIds=[],sectionInputs=document.getElementsByName("mumie_multi_edit_section"),{init:function(){taskSelectionInputs.forEach((function(checkbox){checkbox.onchange=function(){checkbox.checked?selectedTaskIds.push(checkbox.value):selectedTaskIds=selectedTaskIds.filter((function(elem){return elem!==checkbox.value})),selectedTasks.value=JSON.stringify(selectedTaskIds)}})),propertySelectionInputs.forEach((function(checkbox){checkbox.onchange=function(){checkbox.checked?selectedTaskProp.push(checkbox.value):selectedTaskProp=selectedTaskProp.filter((function(elem){return elem!==checkbox.value})),selectedTaskProperties.value=JSON.stringify(selectedTaskProp)}})),sectionInputs.forEach((function(sectionCheckbox){sectionCheckbox.onchange=function(){sectionCheckbox.checked?taskSelectionInputs.forEach((function(taskCheckbox){var array,element;taskCheckbox.getAttribute("section")===sectionCheckbox.value&&(taskCheckbox.checked=!0,array=selectedTaskIds,element=taskCheckbox.value,array.includes(element)||array.push(element))})):taskSelectionInputs.forEach((function(taskCheckbox){taskCheckbox.getAttribute("section")===sectionCheckbox.value&&(taskCheckbox.checked=!1,selectedTaskIds=selectedTaskIds.filter((function(elem){return taskCheckbox.value!==elem})))})),selectedTasks.value=JSON.stringify(selectedTaskIds)}}))}}),worksheetController=(worksheetElement=document.getElementById("id_mumie_worksheet"),{setWorksheet:function(worksheet){worksheet?worksheetElement.setAttribute("value",JSON.stringify(worksheet)):worksheetElement.removeAttribute("value")}});function disableDropDownMenus(errorKey){require(["core/str","core/notification"],(function(str,notification){str.get_strings([{key:errorKey,component:"mod_mumie"}]).done((function(s){notification.addNotification({message:s[0]+"<b>"+missingConfig.getAttribute("value")+"</b>",type:"problem"})})).fail(notification.exception)})),serverController.disable(),problemSelectorController.disable()}return{init:function(contextid,prbSelectorUrl,lang){lmsSelectorUrl=prbSelectorUrl,systemLanguage=lang;var isEdit=document.getElementById("id_name").getAttribute("value"),serverStructure=JSON.parse(document.getElementsByName("mumie_server_structure")[0].value);isEdit&&""!==document.getElementsByName("mumie_missing_config")[0].getAttribute("value")?disableDropDownMenus("mumie_form_missing_server"):serverStructure.length?(serverController.init(serverStructure),courseController.init(),taskController.init(isEdit),multiTaskEditController.init(),problemSelectorController.init()):disableDropDownMenus("mumie_form_no_server_conf"),multiTaskEditController.init(),addServerButton&&require(["auth_mumie/mumie_server_config"],(function(MumieServer){MumieServer.init(addServerButton,contextid)}))}}}));

//# sourceMappingURL=mod_form.min.js.map