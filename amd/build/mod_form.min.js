define ("mod_mumie/mod_form",["jquery","core/templates","core/modal_factory","auth_mumie/mumie_server_config","core/ajax"],function(){var c=document.getElementById("id_add_server_button"),d=document.getElementsByName("mumie_missing_config")[0],e=function(){var b,c=document.getElementById("id_server");return{init:function init(a){b=a;c.onchange=function(){f.updateOptions();g.updateOptions();j.updateOptions();h.updateOptions()}},getSelectedServer:function getSelectedServer(){var a=c.options[c.selectedIndex].text;for(var d in b){var e=b[d];if(e.name==a){return e}}return null},disable:function disable(){c.disabled=!0;a(c)},getAllServers:function getAllServers(){return b}}}(),f=function(){var d=document.getElementById("id_mumie_course"),k=document.getElementsByName("mumie_coursefile")[0];function b(a){var b=document.createElement("option"),c=g.getSelectedLanguage(),e;if(!a.languages.includes(c)){e=a.name[0]}else{for(var f in a.name){if(a.name[f].language==c){e=a.name[f]}}}b.setAttribute("value",e.value);b.text=e.value;d.append(b)}function c(){k.value=f.getSelectedCourse().coursefile}return{init:function init(a){d.onchange=function(){c();g.updateOptions();j.updateOptions();h.updateOptions()};f.updateOptions(a?k.value:!1)},getSelectedCourse:function getSelectedCourse(){var a=d.options[d.selectedIndex].text,b=e.getSelectedServer().courses;for(var c in b){var f=b[c];for(var g in f.name){if(f.name[g].value==a){return f}}}return null},disable:function disable(){d.disabled=!0;a(d)},updateOptions:function updateOptions(){var f=k.value;a(d);d.selectedIndex=0;var g=e.getSelectedServer().courses;for(var h in g){var i=g[h];b(i);if(i.coursefile==f){d.selectedIndex=d.childElementCount-1}}c()}}}(),g=function(){var c=document.getElementById("id_language");function b(a){var b=document.createElement("option");b.setAttribute("value",a);b.text=a;c.append(b)}return{init:function init(){c.onchange=function(){h.updateOptions();f.updateOptions()};g.updateOptions()},getSelectedLanguage:function getSelectedLanguage(){return c.options[c.selectedIndex].text},disable:function disable(){c.disabled=!0;a(c)},updateOptions:function updateOptions(){var d=g.getSelectedLanguage();a(c);c.selectedIndex=0;var e=f.getSelectedCourse().languages;for(var h in e){var i=e[h];b(i);if(i==d){c.selectedIndex=c.childElementCount-1}}}}}(),h=function(){var r=document.getElementById("id_taskurl"),s=document.getElementById("id_name"),t=document.getElementById("id_mumie_complete_course");function b(){if(!c()){s.value=d(h.getSelectedTask())}}function c(){if(0==s.value.length){return!1}return!l().includes(s.value)}function d(a){if(!a){return null}for(var b in a.headline){var c=a.headline[b];if(c.language==g.getSelectedLanguage()){return c.name}}return null}function k(){var a=[];for(var b in e.getAllServers()){var c=e.getAllServers()[b];for(var d in c.courses){var f=c.courses[d];for(var g in f.tasks){var h=f.tasks[g];a.push(h)}}}return a}function l(){var a=[],b=k();b.push(p(f.getSelectedCourse()));for(var c in b){var d=b[c];for(var e in d.headline){a.push(d.headline[e].name)}}var g=f.getSelectedCourse();for(var h in g.name){var i=g.name[h];a.push(i.value)}return a}function m(a){return a.link+"?lang="+g.getSelectedLanguage()}function n(a){if(null!==d(a)){var b=document.createElement("option");b.setAttribute("value",m(a));b.text=d(a);r.append(b)}}function o(a){var b=p(a),c=document.createElement("option");c.setAttribute("value",m(b));c.text=d(b);r.append(c)}function p(a){var b=[];for(var c in a.name){var d=a.name[c];b.push({name:d.value,language:d.language})}return{link:a.link,headline:b}}function q(){return t.checked}return{init:function init(a){b();r.onchange=function(){b()};t.onchange=function(){h.updateOptions();j.updateOptions()};h.updateOptions(a?r.options[r.selectedIndex].getAttribute("value"):void 0)},getSelectedTask:function getSelectedTask(){var a=r.options[r.selectedIndex]==void 0?void 0:r.options[r.selectedIndex].getAttribute("value"),b=f.getSelectedCourse(),c=b.tasks.slice();c.push(p(b));for(var d in c){var e=c[d];if(a==m(e)){return e}}return null},disable:function disable(){r.disabled=!0;a(r)},updateOptions:function updateOptions(c){a(r);r.selectedIndex=0;if(q()){o(f.getSelectedCourse())}else{var d=j.filterTasks(f.getSelectedCourse().tasks);for(var e in d){var g=d[e];n(g);if(c===m(g)){r.selectedIndex=r.childElementCount-1}}}b()},useCompleteCourse:function useCompleteCourse(){return q()}}}(),j=function(){var l=document.getElementById("mumie_filter_section"),m=document.getElementById("mumie_filter_wrapper"),n=document.getElementById("mumie_filter_header"),o=[];function b(a){var b=document.createElement("div");b.classList.add("row","fitem","form-group","mumie-filter");var d=c(a),f=document.createElement("label");f.innerHTML="<i class=\"fa fa-caret-down mumie-icon\"></i>"+a.name;f.classList.add("col-md-3","mumie-collapsable");f.onclick=function(){e(d)};b.appendChild(f);b.appendChild(d);m.appendChild(b)}function c(a){var b=document.createElement("div");b.classList.add("col-md-9","felement","mumie_selection_box");for(var c in a.values){o[a.name]=[];var e=document.createElement("div");e.classList.add("mumie_input_wrapper");var f=a.values[c],g=document.createElement("input");g.type="checkbox";g.value=f;d(a,g);var h=document.createElement("label");h.innerText=f;h.style="padding-left: 5px";e.appendChild(g);e.appendChild(h);b.insertBefore(e,b.firstChild)}return b}function d(a,b){b.onclick=function(){if(!b.checked){var c=[];for(var d in o[a.name]){var e=o[a.name][d];if(e!=b.value){c.push(e)}}o[a.name]=c}else{o[a.name].push(b.value)}h.updateOptions()}}function e(a){a.toggleAttribute("hidden")}function g(a,b){var c=[];for(var d in a){var e=a[d];if(j(e,b)){c.push(e)}}return c}function j(a,b){var c=[];for(var d in a.tags){var e=a.tags[d];c[e.name]=e.values}for(var f in Object.keys(b)){var g=Object.keys(b)[f];if(0==b[g].length){continue}if(!c[g]){return!1}if(!k(b[g],c[g])){return!1}}return!0}function k(a,b){if(!Array.isArray(a)||!Array.isArray(b)){return!1}for(var c=0;c<a.length;c++){if(b.includes(a[c])){return!0}}return!1}return{init:function init(){this.updateOptions();n.onclick=function(){e(m)}},updateOptions:function updateOptions(){if(h.useCompleteCourse()){l.style="display: none"}else{l.style="display: flex"}var c=f.getSelectedCourse().tags;o=[];if(0<c.length){l.hidden=!1}else{l.hidden=!0}a(m);for(var d in c){var e=c[d];b(e)}},filterTasks:function filterTasks(a){return g(a,o)}}}();return{init:function init(a){var i=document.getElementById("id_name").getAttribute("value");if(i&&!b()){require(["core/str","core/notification"],function(a,b){a.get_strings([{key:"mumie_form_missing_server",component:"mod_mumie"}]).done(function(a){b.addNotification({message:a[0]+"<b>"+d.getAttribute("value")+"</b>",type:"problem"})}).fail(b.exception)});e.disable();f.disable();g.disable();h.disable()}else{e.init(JSON.parse(document.getElementsByName("mumie_server_structure")[0].value));f.init(i);h.init(i);g.init();j.init()}if(c){require(["auth_mumie/mumie_server_config"],function(b){b.init(c,a)})}}};function a(a){while(a.firstChild){a.removeChild(a.firstChild)}}function b(){return""===document.getElementsByName("mumie_missing_config")[0].getAttribute("value")}});
//# sourceMappingURL=mod_form.min.js.map
